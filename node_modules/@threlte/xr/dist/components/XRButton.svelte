<!--
@component
`<XRButton />` is an HTML `<button />` that can be used to init and
display info about your WebXR session. This is aliased by `ARButton` and
`VRButton` with sensible session defaults.

```svelte
  <XRButton
    mode={'immersive-ar' | 'immersive-vr' | 'inline'}
    sessionInit={{
      optionalFeatures: ['local-floor', 'bounded-floor', 'hand-tracking', 'layers']
    }}
    force={'enter' | 'exit' | undefined}
    styled={'true' | 'false'}
    on:error={(event) => {}}
    on:click={(event) => {}}
  />
```
-->
<script>import { createEventDispatcher } from "svelte";
import { getXRSupportState } from "../lib/getXRSupportState";
import { toggleXRSession } from "../lib/toggleXRSession";
import { session, xr } from "../internal/stores";
export let mode;
export let sessionInit = void 0;
export let force = void 0;
export let styled = true;
const dispatch = createEventDispatcher();
const handleButtonClick = async (nativeEvent, state) => {
  if (!$xr) {
    throw new Error(
      "The <XR> component was not created. This is required to start an XR session."
    );
  }
  dispatch("click", { state, nativeEvent });
  if (state !== "supported")
    return;
  try {
    await toggleXRSession(mode, sessionInit, force);
  } catch (error) {
    dispatch("error", error);
  }
};
$:
  modeText = {
    "immersive-vr": "VR",
    "immersive-ar": "AR",
    inline: "inline"
  }[mode];
$:
  if (styled) {
    $$restProps.style = `
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      border: 1px solid white;
      background: rgba(0, 0, 0, 0.1);
      color: white;
      outline: none;
      z-index: 10;
      ${$$restProps.style ?? ""}
    `;
  }
</script>

{#await getXRSupportState(mode) then state}
  <button
    {...$$restProps}
    on:click={(event) => handleButtonClick(event, state)}
  >
    {#if state === 'unsupported'}
      {modeText} unsupported
    {:else if state === 'insecure'}
      HTTPS needed
    {:else if state === 'blocked'}
      {modeText} blocked
    {:else if state === 'supported'}
      {$session ? 'Exit' : 'Enter'} {modeText}
    {/if}
  </button>
{/await}
