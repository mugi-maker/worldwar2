<script>import { useStage, useTask, useThrelte, watch } from '@threlte/core';
import { ThreePerf } from 'three-perf';
import { onDestroy } from 'svelte';
import { writable } from 'svelte/store';
export let domElement = document.body;
export let logsPerSecond = 10;
export let showGraph = true;
export let memory = true;
export let enabled = true;
export let visible = true;
export let actionToCallUI = '';
export let guiVisible = false;
export let backgroundOpacity = 0.7;
export let scale = 1;
export let anchorX = 'left';
export let anchorY = 'top';
const { renderer, renderStage, mainStage } = useThrelte();
let perf;
// Has to be fully re-initialized if dom element changes
const domElementStore = writable(domElement);
$: domElementStore.set(domElement);
watch([domElementStore], ([domElement]) => {
    if (perf)
        perf.dispose();
    perf = new ThreePerf({
        domElement: domElement || document.body,
        renderer: renderer
    });
});
$: perf.logsPerSecond = logsPerSecond;
$: perf.showGraph = showGraph;
$: perf.memory = memory;
$: perf.enabled = enabled;
$: perf.visible = visible;
$: perf.actionToCallUI = actionToCallUI;
$: perf.guiVisible = guiVisible;
$: perf.backgroundOpacity = backgroundOpacity;
$: perf.scale = scale;
$: perf.anchorX = anchorX;
$: perf.anchorY = anchorY;
useTask(() => {
    perf.begin();
}, {
    stage: useStage('monitor-begin', {
        before: mainStage
    })
});
useTask(() => {
    perf.end();
}, {
    stage: useStage('monitor-end', {
        after: renderStage
    })
});
onDestroy(() => {
    if (perf)
        perf.dispose();
});
</script>
