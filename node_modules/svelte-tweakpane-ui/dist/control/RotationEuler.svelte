<script context="module"></script>

<script>
	import * as pluginModule from '@kitschpatrol/tweakpane-plugin-rotation';
	import ClsPad from '../internal/ClsPad.svelte';
	import GenericInputFolding from '../internal/GenericInputFolding.svelte';
	import { BROWSER } from 'esm-env';
	export let value;
	export let order = void 0;
	export let unit = void 0;
	export let optionsX = void 0;
	export let optionsY = void 0;
	export let optionsZ = void 0;
	export let expanded = void 0;
	let options;
	let internalValue;
	const buttonClass = 'tp-rotationswatchv_b';
	function updateInternalValue() {
		if (Array.isArray(value)) {
			const [x, y, z] = value;
			internalValue = { x, y, z };
		} else {
			internalValue = value;
		}
	}
	function updateValue() {
		if (Array.isArray(value)) {
			const { x, y, z } = internalValue;
			value = [x, y, z];
		} else {
			value = internalValue;
		}
	}
	$: value, updateInternalValue();
	$: internalValue, updateValue();
	$: options = {
		x: optionsX,
		y: optionsY,
		z: optionsZ,
		order,
		rotationMode: 'euler',
		unit,
		view: 'rotation'
	};
</script>

<GenericInputFolding
	bind:value={internalValue}
	bind:expanded
	on:change
	{buttonClass}
	{options}
	plugin={pluginModule}
	{...$$restProps}
/>
{#if !BROWSER && expanded && $$props.picker === 'inline'}
	{#if $$props.label !== undefined}
		<ClsPad
			keysAdd={['bladeValueWidth']}
			keysSubtract={[`containerUnitSize`]}
			theme={$$props.theme}
		/>
	{:else}
		<!-- Without a label, the grid takes the full width of the control -->
		<!-- TODO remove magic number -->
		<div style="aspect-ratio: 1; width: calc(100% - 28px);"></div>
	{/if}
{/if}
