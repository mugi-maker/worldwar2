import{ClassName as t,SVG_NS as e,mapRange as r,createPlugin as i,parseRecord as o,ValueMap as n}from"@tweakpane/core";class a{constructor(){this.drawer=t=>`L ${t[0]} ${t[1]}`}}class s{constructor(){this.drawer=(t,e,r)=>{const[i,o]=this.controlPoint(r[e-1],r[e-2],t),[n,a]=this.controlPoint(t,r[e-1],r[e+1],!0);return`C ${i},${o} ${n},${a} ${t[0]},${t[1]}`}}controlPoint(t,e,r,i){const o=e||t,n=r||t,a=n[0]-o[0],s=n[1]-o[1],l=.2*Math.sqrt(Math.pow(a,2)+Math.pow(s,2)),p=Math.atan2(s,a)+(i?Math.PI:0);return[t[0]+Math.cos(p)*l,t[1]+Math.sin(p)*l]}}const l=t("wfm");class p{constructor(t,r){switch(this.element=t.createElement("div"),this.element.classList.add(l()),r.viewProps.bindClassModifiers(this.element),this.svgElem=t.createElementNS(e,"svg"),this.svgElem.classList.add(l("g")),this.element.appendChild(this.svgElem),this.pathElem=t.createElementNS(e,"path"),this.svgElem.appendChild(this.pathElem),this.props=r.props,this.value=r.value,this.value.emitter.on("change",this.onValueChange_.bind(this)),this.props.get("lineStyle")){case"linear":default:this.lineDrawerProvider=new a;break;case"bezier":this.lineDrawerProvider=new s}this.refresh(),r.viewProps.handleDispose((()=>{this.value.emitter.off("change",this.onValueChange_)}))}svgPath(t,e){return t.reduce(((t,r,i,o)=>0===i?`M ${r[0]},${r[1]}`:`${t} ${e(r,i,o)}`),"")}refresh(){var t,e;const i=this.svgElem.getBoundingClientRect(),o=this.value.rawValue[0];if(o){const n=null!==(t=this.props.get("min"))&&void 0!==t?t:Math.min(...o)-1,a=null!==(e=this.props.get("max"))&&void 0!==e?e:Math.max(...o)+1,s=a-n,l=[],p=o.length-1,h=o.length>32?0:i.width/(o.length-1),c=s>50?0:i.height/s;this.element.style.backgroundSize=`${h}px ${c}px`,o.forEach(((t,e)=>{if(void 0===t)return;const o=r(e,0,p,0,i.width),s=r(t,n,a,i.height,0);l.push([Math.floor(o),Math.floor(s)])}));const v=this.svgPath(l,this.lineDrawerProvider.drawer);this.pathElem.setAttributeNS(null,"d",v)}}onValueChange_(){this.refresh()}}class h{constructor(t,e){this.value=e.value,this.props=e.props,this.viewProps=e.viewProps,this.viewProps.handleDispose((()=>{})),this.view=new p(t,{value:this.value,viewProps:this.viewProps,props:this.props})}}function c(t){return"object"==typeof t&&"length"in t}const v="waveform",m=".tp-wfmv_g{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-wfmv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-wfmv_g::-webkit-scrollbar{height:8px;width:8px}.tp-wfmv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-wfmv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-wfmv{position:relative;background-image:linear-gradient(to right, var(--cnt-bg), 1px, transparent 1px),linear-gradient(to bottom, var(--cnt-bg), 1px, transparent 1px)}.tp-wfmv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-wfmv_g path{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-wfmv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-wfmv_t.tp-wfmv_t-a{visibility:visible}.tp-wfmv_t.tp-wfmv_t-in{transition:none}.tp-wfmv.tp-v-disabled .tp-wfmv_g{opacity:.5}.tp-wfmv .tp-ttv{background-color:var(--mo-fg)}.tp-wfmv .tp-ttv::before{border-top-color:var(--mo-fg)}",d=[i({id:"monitor-waveform",type:"monitor",accept:(t,e)=>{if(!c(t))return null;const r=o(e,(t=>({max:t.optional.number,min:t.optional.number,style:t.optional.custom((t=>"linear"===t||"bezier"===t?t:void 0)),view:t.optional.string})));return r?{initialValue:t,params:r}:null},binding:{defaultBufferSize:t=>function(t){return"view"in t&&"waveform"===t.view}(t)?64:1,reader:t=>t=>c(t)?t:[]},controller:t=>{var e,r,i;return new h(t.document,{props:n.fromObject({max:null!==(e="max"in t.params?t.params.max:null)&&void 0!==e?e:null,min:null!==(r="min"in t.params?t.params.min:null)&&void 0!==r?r:null,lineStyle:null!==(i="style"in t.params?t.params.style:null)&&void 0!==i?i:"linear"}),value:t.value,viewProps:t.viewProps})}})];export{m as css,v as id,d as plugins};
