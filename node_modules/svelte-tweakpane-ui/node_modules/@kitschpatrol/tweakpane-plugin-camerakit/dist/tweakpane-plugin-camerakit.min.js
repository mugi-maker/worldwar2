import{ClassName as t,SVG_NS as e,removeElement as i,constrainRange as r,createValue as s,PointerHandler as n,NumberTextController as o,createRangeConstraint as a,createStepConstraint as l,CompositeConstraint as p,createPlugin as c,parseRecord as h,createNumberTextInputParamsParser as v,numberFromUnknown as u,writePrimitive as m,createNumberTextPropsObject as d,ValueMap as _,parseNumber as k,createNumberFormatter as w,getDecimalDigits as f}from"@tweakpane/core";const b=t("ckr");class g{constructor(i,r){this.tickElems_=[],this.labelElems_=[],this.boundsWidth_=-1,this.onShowsTooltipChange_=this.onShowsTooltipChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.formatters_=r.formatters,this.unit_=r.unit,this.element=i.createElement("div"),this.element.classList.add(b(),b(void 0,`m${r.seriesId}`)),r.viewProps.bindClassModifiers(this.element),this.value_=r.value,this.value_.emitter.on("change",this.onValueChange_),r.showsTooltip.emitter.on("change",this.onShowsTooltipChange_);const s=i.createElement("div");s.classList.add(b("w")),this.element.appendChild(s),this.offsetElem_=i.createElement("div"),this.offsetElem_.classList.add(b("o")),s.appendChild(this.offsetElem_),this.svgElem_=i.createElementNS(e,"svg"),this.svgElem_.classList.add(b("g")),this.offsetElem_.appendChild(this.svgElem_),this.tooltipElem_=i.createElement("div"),this.tooltipElem_.classList.add(t("tt")(),b("tt")),this.element.appendChild(this.tooltipElem_),this.waitToBeAdded_()}waitToBeAdded_(){const t=new IntersectionObserver((e=>{e.forEach((e=>{e.target===this.element&&0!==e.intersectionRatio&&(this.update(),t.disconnect())}))}),{root:null});t.observe(this.element)}rebuildScaleIfNeeded_(t){if(this.boundsWidth_===t)return;this.boundsWidth_=t,this.tickElems_.forEach((t=>{i(t)})),this.tickElems_=[],this.labelElems_.forEach((t=>{i(t)})),this.labelElems_=[];const r=this.element.ownerDocument,s=this.unit_.ticks,n=this.unit_.pixels,o=(2*(Math.ceil(t/2/n)+1)+1)*s,a=n/s;for(let t=0;t<o;t++){const i=t*a;if(t%s==0){const t=r.createElementNS(e,"line");t.classList.add(b("mjt")),t.setAttributeNS(null,"x1",String(i)),t.setAttributeNS(null,"y1","0"),t.setAttributeNS(null,"x2",String(i)),t.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(t),this.tickElems_.push(t);const s=r.createElement("div");s.classList.add(b("l")),s.style.left=`${i}px`,this.offsetElem_.appendChild(s),this.labelElems_.push(s)}else{const t=r.createElementNS(e,"line");t.classList.add(b("mnt")),t.setAttributeNS(null,"x1",String(i)),t.setAttributeNS(null,"y1","0"),t.setAttributeNS(null,"x2",String(i)),t.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(t),this.tickElems_.push(t)}}}updateScale_(t){const e=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,n=Math.ceil(t/2/i)+1,o=s-s%e-e*n,a=n=>1-Math.pow(r(Math.abs(s-n)/(t/2*(e/i)),0,1),10);this.labelElems_.forEach(((t,i)=>{const r=o+i*e;t.textContent=this.formatters_.ring(r),t.style.opacity=String(a(r))}));const l=this.unit_.ticks;this.tickElems_.forEach(((t,i)=>{const r=o+i/l*e;t.style.opacity=String(a(r))}))}update(){const t=this.element.getBoundingClientRect().width,e=this.unit_.value,i=this.unit_.pixels,r=this.value_.rawValue,s=t/2-i/e*(r%e+e*(Math.ceil(t/2/i)+1));this.offsetElem_.style.transform=`translateX(${s}px)`,this.tooltipElem_.textContent=this.formatters_.text(r),this.rebuildScaleIfNeeded_(t),this.updateScale_(t)}onValueChange_(){this.update()}onShowsTooltipChange_(t){t.rawValue?this.element.classList.add(b(void 0,"tt")):this.element.classList.remove(b(void 0,"tt"))}}class x{constructor(t,e){this.ox_=0,this.ov_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.tooltipEnabled_=e.tooltipEnabled,this.unit_=e.unit,this.showsTooltip_=s(!1),this.view=new g(t,{formatters:e.formatters,seriesId:e.seriesId,showsTooltip:this.showsTooltip_,unit:e.unit,value:this.value,viewProps:this.viewProps});const i=new n(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}onPointerDown_(t){const e=t.data;e.point&&(this.ox_=e.point.x,this.ov_=this.value.rawValue,this.tooltipEnabled_&&(this.showsTooltip_.rawValue=!0))}onPointerMove_(t){const e=t.data;if(!e.point)return;const i=e.point.x-this.ox_,r=this.unit_.pixels,s=this.unit_.value;this.value.setRawValue(this.ov_-i/r*s,{forceEmit:!1,last:!1})}onPointerUp_(){this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0}),this.showsTooltip_.rawValue=!1}}const E=t("ckrtxt");class P{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(E());const i=t.createElement("div");i.classList.add(E("r")),i.appendChild(e.ringView.element),this.element.appendChild(i);const r=t.createElement("div");r.classList.add(E("t")),r.appendChild(e.textView.element),this.element.appendChild(r)}}class y{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.rc_=new x(t,{formatters:{ring:e.ringFormatter,text:e.textProps.get("formatter")},seriesId:e.seriesId,tooltipEnabled:!1,unit:e.ringUnit,value:this.value,viewProps:this.viewProps}),this.tc_=new o(t,{parser:e.parser,props:e.textProps,value:this.value,viewProps:this.viewProps}),this.view=new P(t,{ringView:this.rc_.view,textView:this.tc_.view})}}function S(t){const e=[],i=a(t);i&&e.push(i);const r=l(t);return r&&e.push(r),new p(e)}function C(t){return 0===t||1===t||2===t?t:void 0}function V(t){return void 0!==t?String(t):"0"}const L="camerakit",N='.tp-ckrv_w{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-ckrv_w{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-ckrv_w:hover{background-color:var(--in-bg-h)}.tp-ckrv_w:focus{background-color:var(--in-bg-f)}.tp-ckrv_w:active{background-color:var(--in-bg-a)}.tp-ckrv_w:disabled{opacity:.5}.tp-ckrv{position:relative}.tp-ckrv.tp-v-disabled{opacity:.5}.tp-ckrv::before{background-color:var(--grv-fg);bottom:0;content:"";height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-ckrv::after{background-color:var(--in-fg);content:"";left:0;margin:auto;position:absolute;right:0}.tp-ckrv_w{cursor:pointer;height:calc(var(--cnt-usz));overflow:hidden}.tp-ckrv_o{height:100%;left:0;position:relative}.tp-ckrv_g{display:block;height:2px;overflow:visible;position:absolute;width:100%}.tp-ckrv_mjt{stroke:var(--in-fg);stroke-width:2;transform-origin:bottom}.tp-ckrv_mnt{stroke:var(--in-fg);stroke-width:1;transform-origin:bottom}.tp-ckrv_l{color:var(--in-fg);font-size:.9em;pointer-events:none;position:absolute;top:0;transform:translateX(-50%);white-space:pre}.tp-ckrv_tt{left:50%;top:-4px;visibility:hidden}.tp-ckrv.tp-ckrv-tt .tp-ckrv_tt{visibility:visible}.tp-ckrv.tp-ckrv-m0::before{display:none}.tp-ckrv.tp-ckrv-m0::after{bottom:0;height:6px;width:2px}.tp-ckrv.tp-ckrv-m0 .tp-ckrv_g{bottom:0;margin:auto;transform:translateY(3px);top:0}.tp-ckrv.tp-ckrv-m0 .tp-ckrv_mjt{transform:scaleY(3)}.tp-ckrv.tp-ckrv-m0 .tp-ckrv_mnt{transform:scaleY(2)}.tp-ckrv.tp-ckrv-m0 .tp-ckrv_l{line-height:8px;transform:translateX(-50%) scale(0.8)}.tp-ckrv.tp-ckrv-m1::before{display:none}.tp-ckrv.tp-ckrv-m1::after{bottom:0;height:8px;width:2px}.tp-ckrv.tp-ckrv-m1 .tp-ckrv_g{bottom:0}.tp-ckrv.tp-ckrv-m1 .tp-ckrv_mjt{stroke-width:1;transform:scaleY(4)}.tp-ckrv.tp-ckrv-m1 .tp-ckrv_mnt{transform:scaleY(2)}.tp-ckrv.tp-ckrv-m1 .tp-ckrv_l{line-height:12px}.tp-ckrv.tp-ckrv-m2::before{transform:translateY(3px)}.tp-ckrv.tp-ckrv-m2::after{border-radius:2px;bottom:1px;height:4px;width:4px}.tp-ckrv.tp-ckrv-m2 .tp-ckrv_g{display:none}.tp-ckrv.tp-ckrv-m2 .tp-ckrv_l{line-height:12px;transform:translateX(-50%)}.tp-ckrv.tp-ckrv-mw::before,.tp-ckrv.tp-ckrv-mw::after{display:none}.tp-ckrv.tp-ckrv-mw .tp-ckrv_g{bottom:0;opacity:.2}.tp-ckrv.tp-ckrv-mw .tp-ckrv_mjt,.tp-ckrv.tp-ckrv-mw .tp-ckrv_mnt{stroke:var(--in-fg);stroke-width:2;transform:scaleY(10)}.tp-ckrv.tp-ckrv-mw .tp-ckrv_l{display:none}.tp-ckrtxtv{display:flex}.tp-ckrtxtv_r{flex:2}.tp-ckrtxtv_t{flex:1;margin-left:4px}',j=[c({id:"input-ring",type:"input",accept(t,e){if("number"!=typeof t)return null;const i=h(e,(t=>Object.assign(Object.assign({},v(t)),{series:t.optional.custom(C),unit:t.optional.object({pixels:t.required.number,ticks:t.required.number,value:t.required.number}),view:t.required.constant("cameraring"),wide:t.optional.boolean})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>u,constraint:t=>S(t.params),writer:t=>m},controller(t){var e,i,r;const s=null!==(e=t.params.unit)&&void 0!==e?e:{ticks:5,pixels:40,value:10},n=function(t){const e=w(f(t.value));return t=>{const i=e(t),r=i.substr(0,1);return i+("-"===r||"+"===r?" ":"")}}(s),o=d(t.params,t.initialValue);if(t.params.wide)return new x(t.document,{formatters:{ring:n,text:o.formatter},seriesId:null!==(i=V(t.params.series))&&void 0!==i?i:"0",tooltipEnabled:!0,unit:s,value:t.value,viewProps:t.viewProps});const a=_.fromObject(o);return new y(t.document,{parser:k,ringFormatter:n,ringUnit:s,seriesId:null!==(r=V(t.params.series))&&void 0!==r?r:"0",textProps:a,value:t.value,viewProps:t.viewProps})}}),c({id:"input-wheel",type:"input",accept(t,e){if("number"!=typeof t)return null;const i=h(e,(t=>Object.assign(Object.assign({},v(t)),{amount:t.optional.number,view:t.required.constant("camerawheel"),wide:t.optional.boolean})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>u,constraint:t=>S(t.params),writer:t=>m},controller(t){var e,i;const r=w(0),s=d(t.params,t.initialValue);return t.params.wide?new x(t.document,{formatters:{ring:r,text:s.formatter},seriesId:"w",tooltipEnabled:!0,unit:{ticks:10,pixels:40,value:40*(null!==(e=t.params.amount)&&void 0!==e?e:s.pointerScale)},value:t.value,viewProps:t.viewProps}):new y(t.document,{parser:k,ringFormatter:r,ringUnit:{ticks:10,pixels:40,value:40*(null!==(i=t.params.amount)&&void 0!==i?i:s.pointerScale)},seriesId:"w",textProps:_.fromObject(s),value:t.value,viewProps:t.viewProps})}})];export{N as css,L as id,j as plugins};
